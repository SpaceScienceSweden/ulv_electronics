\documentclass{article}
\usepackage{listings}
\usepackage[table]{xcolor}
\usepackage{varioref}
\usepackage{float}
\begin{document}

\title{KUB manual}
\date{October 15, 2017}
\author{Tomas H\"ardin}

\maketitle

\newpage

\tableofcontents
\listoffigures
\listoftables

\newpage

\section{Greeting}
Hello world!



Culpa aliquid aperiam consequatur iste aut corrupti. Eos non harum dolor corrupti magnam consequuntur quod. Eos et quam culpa asperiores inventore ad distinctio sunt. Non in alias facilis quam quis vero quod dignissimos. Culpa ipsam velit quia. Ipsa eum enim repudiandae ut sunt doloribus.

Aut assumenda aut asperiores. Rerum ut nihil quisquam et. Quia et tempora vel. Illo excepturi soluta repellendus id debitis. Totam fuga doloribus exercitationem eius.

Et dolores amet id velit. Et ab saepe suscipit temporibus iusto. Odio dicta error voluptas veritatis ab ut aut doloribus. Et facere illo autem ea saepe accusantium eos minus.

Quis quidem porro tempora consequatur. Voluptatibus adipisci quibusdam illo magnam. Ut consequatur quia ipsum. Enim ea tenetur mollitia sed quaerat et neque officiis. Nostrum harum explicabo ut.

Culpa quia voluptas cumque officia. Impedit est ad et assumenda dolorem ex et. Voluptatem atque alias dicta ratione laborum modi rem.

\section{Assembly}


The instrument consists of a stainless steel skeleton into which a number of plates are screwed.
All plates except one has a printed circuit board (PCB) attached
In this section we assume all PCBs have already been soldered and cleaned.


\subsection{fieldmill9}

For each fieldmill9 module you will need the following parts and materials:

\begin{itemize}
\item One (1) fieldmill9 / fieldmill\_top\_plate4 PCB assembly
\item One (1) fieldmill aluminium top plate
\item One (1) Maxon 349694 EC motor
\item Two (2) 100 Âµm stainless steel motor shims
\item One (1) ITR20001/T IR reflex coupler
\item Three (3) M2 screws, 6 mm length including head (Phillips PH1)
\item Four (4) silver plated M3 screws, 10 mm length including head (Torx T10)
\item Four (4) M3 washers
\item Four (4) M3 hex nuts
\item One (1) M4 X 8/8 hex screw with 2 mm hole drilled through, preferably silver plated or silver painted if someone forgot to order silver plated M4 screws
\item One (1) silver plated M4 flange nut
\item Loctite 603
\item Scotch-Weld 2216
\end{itemize}

The following tools are also needed:

\begin{itemize}
\item A small semi-round file
\item Torque wrenches capable of 0.3 Nm and 0.8 Nm with the following bits:
\begin{itemize}
\item PH1 Phillips
\item 5.5 mm socket
\end{itemize}
\item 9IP Torx-Plus or T10 Torx driver or bit
\end{itemize}


Cut motor wires to 6-7 mm length.
Strip so that 3 mm of insulation remains.
Twist and tin the ends of the wires.

Use a small semi-round file to grind away the perforation remains in the middle hole of the PCB,
so that a motor will fit loosely.

Mount the Maxon EC motor in the motor hole with two motor shims inbetween.
The shims should raise the motor enough that a small lip / edge can be felt on the top side of the assembly between the motor housing and the fieldmill\_top\_plate4 PCB.

Solder the five motor wires to the motor wire pads on the PCB.

Bend and cut the IR reflex coupler leads so that the reflex coupler looks directly at the EC motor's rotor when inserted into its socket (IR2 reference on PCB).

Screw the motor + PCB assembly to the aluminium plate using the M2 screws for the motor and silver plated M3 screws, washes and nuts for the PCB.
First screw in the screws lightly, then tighten using the torque wrench. Use 0.3 Nm for the M2 screws and 0.8 Nm for the M3 nuts.


\subsection{cpu3}


\subsection{power4}


\subsection{credits}




\section{Commands}

All commands are human-readable, start with a single ASCII character and are termianted with a line ending.
If the command takes no parameters then the line ending is optional.
Comments may be added by inserting a hash sign ('\#').
This causes the rest of the line to be ignored (characters are consumed and discarded until end-of-line).
Parameter parsing is handled by sscanf(), which allows for the same command character to take a varying number
of parameters. An example of this is the 'M' command which exists in two-parameter and three-parameter forms:

\begin{lstlisting}
    M0 10       # Set speed of motor 0 to 10
    M10 10 10   # Set speed of all motors to 10
\end{lstlisting}


Line endings can either be carriage return ('{\textbackslash}r', ASCII code 13) or linefeed ('{\textbackslash}n', ASCII code 10), but never both in the same line.
In other words both Unix and Mac line endings are OK, but Windows line endings ("{\textbackslash}r{\textbackslash}n") are not.
This ensures both {\it echo} and {\it minicom} works as expected.
Output from the instrument is terminated by Windows line endings however, in order to work well with {\it minicom}.

Table \vref{command_table} summarizes all commands and their parameters.
More detailed descriptions of each command are given in the subsections that follow.

\definecolor{lgray}{gray}{0.95}
\definecolor{dgray}{gray}{0.90}

\begin{table}[H]
\begin{centering}
\rowcolors{1}{lgray}{dgray}
\begin{tabular}{|p{1.8cm}|p{1.8cm}|p{1.8cm}|p{5cm}|}
\hline
{\bf Command} & {\bf Parameter count} & {\bf Parameter syntax} & {\bf Description} \\ \hline
v & 0 &                     & Measure system voltages \\ \hline
V & 0 &                     & Enable 24V and +-5V \\ \hline
B & 0 &                     & Disable 24V and +-5V \\ \hline
m & 0 &                     & Read motor speeds \\ \hline
M & 2 & ID spd              & Set motor speed \\ \hline
M & 3 & spd spd spd         & Set motor speeds \\ \hline
K & 0 &                     & Set motor speeds to 50\% \\ \hline
  & 0 &                     & Stop all motors \\ \hline
  & 1 & ID                  & Stop specific motor \\ \hline
  & 0 &                     & Measure motor speeds in RPM \\ \hline
  & 1 &                     & Measure specific motor speed in RPM \\ \hline
  &   &                     & Measure temperatures \\ \hline
  &   &                     & Configure ADC \\ \hline
  &   &                     & Read ADC configuration \\ \hline
  &   &                     & Read registers (\$0000 - \$00FF) \\ \hline
  &   &                     & Write registers (\$0000 - \$00FF) \\ \hline
  &   &                     & Read RAM (\$0100 - \$FFFF) \\ \hline
  &   &                     & Write RAM (\$0100 - \$FFFF) \\ \hline
  &   &                     & Read EEPROM (\$000 - \$FFF) \\ \hline
  &   &                     & Write EEPROM (\$000 - \$FFF) \\ \hline
  &   &                     & Read ROM (\$00000 - \$1FFFF) \\ \hline
  &   &                     & Read fuses \\ \hline
  &   &                     & Read clock \\ \hline
  &   &                     & Set clock \\ \hline
  &   &                     & Configure measurement (block size + gap) \\ \hline
  &   &                     & Read measurement configuration \\ \hline
  &   &                     & Start measurement \\ \hline
{\textbackslash}x1B (ESC)  &   &                     & Stop measurement \\ \hline
\end{tabular}
\caption{Command table}
\label{command_table}
\end{centering}
\end{table}

\subsection{Read motor speed ('m')}

Prints three integers containing OCR1A, OCR1B and OCR1C respectively.
0 - 255 roughly corresponding to 0 - 100\% or 0 - 6000 RPM.

\subsection{Set motor speed(s) ('M')}

Hardware will refuse if values are so low that they risk turning the motors off.

\section{Listing}

\lstinputlisting{sample_packet_s.h}



\end{document}
